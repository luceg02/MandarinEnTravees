{% extends 'base.html.twig' %}

{% block title %}Le Mandarin en Travées - Fact-checking collaboratif{% endblock %}

{% block stylesheets %}
    <link href="{{ asset('css/homepage.css') }}" rel="stylesheet">
{% endblock %}

{% block body %}
    <!-- Header avec navigation -->
    <header class="main-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-3">
                    <div class="logo-container">
                        <div class="logo-icon">M</div>
                        <span class="logo-text">LE MANDARIN<br><small style="font-size: 0.7em;">EN TRAVÉES</small></span>
                    </div>
                </div>
                <div class="col-md-6 text-center">
                        <nav>
    {% for categorie in categories %}
        <a href="#" class="nav-link">{{ categorie.nom|upper }}</a>
    {% endfor %}
                    </nav>
                </div>
                <div class="col-md-3 text-end">
                    <div class="d-flex align-items-center justify-content-end">
                        <input type="text" placeholder="Rechercher..." class="search-input">
                        <a href="/login" style="color: white; font-size: 1.5rem;"><i class="fas fa-user-circle"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Section héro bleue -->
    <section class="hero-section">
        <div class="container">
            <h1 class="hero-title">Combattons les Fake News ensemble</h1>
            <p class="hero-subtitle">Rejoignez la communauté la plus active de fact-checkers et gagnez en réputation en défendant la vérité</p>
            <a href="{{ path('app_demande_nouvelle') }}" class="cta-button">Soumettre une vérification</a>
        </div>
    </section>

    <!-- Contenu principal -->
    <main class="main-content">
        <div class="container">
            <div class="row">
                <!-- Colonne gauche - Fact-checks -->
                <div class="col-lg-8">
                    <h2 class="section-title">Derniers Fact-checks</h2>

                    {% if demandes is defined and demandes|length > 0 %}
                        <!-- Données de la BD -->
                        {% for demande in demandes %}
                            <div class="fact-check-card">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <span class="status-badge status-{{ demande.statut|lower|replace({' ': '-'}) }}">
                                        {{ demande.statut|upper }}
                                    </span>
                                    <span class="card-meta">
                                        {{ demande.dateCreation|date('d/m/Y à H\\hi') }} • 
                                        {% if demande.categorie %}
                                            {{ demande.categorie.nom|lower }}
                                        {% else %}
                                            non catégorisé
                                        {% endif %}
                                    </span>
                                </div>
                                <h3 class="card-title">{{ demande.titre }}</h3>
                                <p class="card-excerpt">{{ demande.description|slice(0, 150) }}...</p>
                                <div class="d-flex justify-content-between align-items-center card-footer">
                                    <span style="color: #4a5568; font-weight: 500;">
                                        {% if demande.auteur %}
                                            {% if demande.auteur.nom and demande.auteur.prenom %}
                                                {{ demande.auteur.prenom }} {{ demande.auteur.nom }}
                                            {% else %}
                                                {{ demande.auteur.email|split('@')[0] }}
                                            {% endif %}
                                        {% else %}
                                            Utilisateur inconnu
                                        {% endif %}
                                    </span>
                                    <span style="color: #718096; font-size: 0.9rem;">{{ demande.nbReponses }} réponse{{ demande.nbReponses > 1 ? 's' : '' }}</span>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <!-- Affichage quand aucune demande -->
                        <div style="text-align: center; padding: 2rem; background: white; border-radius: 8px; margin-bottom: 2rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h3 style="color: #4a5568; margin-bottom: 1rem;">Aucune demande pour le moment</h3>
                            <p style="color: #718096; margin-bottom: 1.5rem;">Soyez le premier à soumettre une demande de fact-checking !</p>
                            <a href="{{ path('app_demande_nouvelle') }}" style="background-color: #3182ce; color: white; padding: 0.75rem 1.5rem; border-radius: 8px; text-decoration: none; display: inline-block;">
                                Créer ma première demande
                            </a>
                        </div>
                    {% endif %}
                </div>

                <!-- Sidebar droite -->
                <aside class="col-lg-4" style="padding-left: 2rem;">
                    <!-- Top contributeurs -->
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">Top contributeurs</h3>
                        {% if topContributeurs is defined and topContributeurs|length > 0 %}
                            {% for contributeur in topContributeurs %}
                                <div class="contributor-item">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <div style="color: #4a5568; font-weight: 500; font-size: 0.9rem;">
                                                {% if contributeur.nom and contributeur.prenom %}
                                                    {{ contributeur.prenom }} {{ contributeur.nom }}
                                                {% else %}
                                                    {{ contributeur.email|split('@')[0] }}
                                                {% endif %}
                                            </div>
                                            <div style="color: #718096; font-size: 0.8rem;">
                                                {% if 'ROLE_JOURNALISTE' in contributeur.roles %}
                                                    Journaliste
                                                {% else %}
                                                    Contributeur
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="contributor-score">
                                            {% if contributeur.fakeScore is defined %}
                                                {% if contributeur.fakeScore >= 1000 %}
                                                    {{ (contributeur.fakeScore / 1000)|number_format(1) }}K
                                                {% else %}
                                                    {{ contributeur.fakeScore }}
                                                {% endif %}
                                            {% else %}
                                                0
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <!-- Données fictives -->
                            <div class="contributor-item">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <div style="color: #4a5568; font-weight: 500; font-size: 0.9rem;">Pierre Martin</div>
                                        <div style="color: #718096; font-size: 0.8rem;">Journaliste</div>
                                    </div>
                                    <div class="contributor-score">1.2K</div>
                                </div>
                            </div>
                        {% endif %}
                    </div>

                    <!-- Tendances (toujours fictives) -->
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">Tendances du jour</h3>
                        <div style="padding: 0.75rem 0; border-bottom: 1px solid #f1f5f9;">
                            <div style="color: #4a5568; font-weight: 500; font-size: 0.9rem;">Élections européennes (12 questions)</div>
                        </div>
                        <div style="padding: 0.75rem 0;">
                            <div style="color: #4a5568; font-weight: 500; font-size: 0.9rem;">Inflation alimentaire (8 questions)</div>
                        </div>
                    </div>

                    <!-- Statistiques -->
                    <div class="sidebar-section text-center">
                        {% if stats is defined %}
                            <div style="margin-bottom: 2rem;">
                                <span class="stats-number">{{ stats.totalDemandes|number_format(0, ',', '.') }}</span>
                                <span class="stats-label">Fact-checks publiés</span>
                            </div>
                            <div>
                                <span class="stats-number">{{ stats.totalUtilisateurs|number_format(0, ',', '.') }}</span>
                                <span class="stats-label">Contributeurs actifs</span>
                            </div>
                        {% else %}
                            <!-- Données fictives -->
                            <div style="margin-bottom: 2rem;">
                                <span class="stats-number">1,247</span>
                                <span class="stats-label">Fact-checks publiés</span>
                            </div>
                            <div>
                                <span class="stats-number">700</span>
                                <span class="stats-label">Contributeurs actifs</span>
                            </div>
                        {% endif %}
                    </div>
                </aside>
            </div>
        </div>
    </main>
{% endblock %}